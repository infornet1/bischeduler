<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#003366">
    <title>Panel de Control - BiScheduler</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/bischeduler/static/css/styles.css">
    <link rel="stylesheet" href="/bischeduler/static/css/dark-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            min-height: 100vh;
            padding: 20px 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .user-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--card-bg, rgba(255, 255, 255, 0.95));
            border-radius: 25px;
            padding: 8px 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-bar .user-name {
            color: var(--text-primary, #212529);
            font-weight: 500;
        }

        .user-dropdown-toggle {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            padding: 0 !important;
            color: var(--text-primary) !important;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .user-dropdown-toggle:hover,
        .user-dropdown-toggle:focus,
        .user-dropdown-toggle:active {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            color: var(--text-primary) !important;
        }

        .user-dropdown-toggle .fas {
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }

        .user-dropdown-toggle[aria-expanded="true"] .fas {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            background: var(--card-bg, rgba(255, 255, 255, 0.98));
            border: 1px solid var(--border-color, rgba(0, 0, 0, 0.1));
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 8px 0;
            margin-top: 8px;
            min-width: 200px;
        }

        .dropdown-item {
            color: var(--text-primary) !important;
            padding: 8px 16px;
            transition: all 0.3s ease;
            border: none;
        }

        .dropdown-item:hover,
        .dropdown-item:focus {
            background: var(--hover-bg, rgba(0, 0, 0, 0.05));
            color: var(--text-primary, #212529) !important;
        }

        .dropdown-item-text {
            padding: 8px 16px;
            color: var(--text-secondary);
        }

        .dropdown-divider {
            border-color: var(--border-color);
            margin: 4px 0;
        }

        .custom-control-input:checked ~ .custom-control-label::before {
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            border-color: transparent;
        }

        .custom-control-label::before {
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .custom-control-label::after {
            transition: all 0.3s ease;
        }

        .quick-stats {
            background: var(--card-bg, rgba(255, 255, 255, 0.95));
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 900px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            color: var(--text-primary, #212529);
        }

        /* Force dark mode styles for quick stats */
        [data-theme="dark"] .quick-stats {
            background: var(--card-bg, rgba(30, 30, 30, 0.95)) !important;
            color: var(--text-primary, #ffffff) !important;
        }

        [data-theme="dark"] .stat-value {
            color: var(--text-primary, #ffffff) !important;
        }

        [data-theme="dark"] .stat-label {
            color: var(--text-secondary, #b0b0b0) !important;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .stat-item {
            padding: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .app-tile {
            background: var(--card-bg, rgba(255, 255, 255, 0.95));
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--text-primary, #212529);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color, rgba(255, 255, 255, 0.2));
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .app-tile:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            color: var(--text-primary);
        }

        .app-tile::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .app-tile:hover::before {
            animation: shine 0.5s ease;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
                opacity: 0;
            }
        }

        .app-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
            background: linear-gradient(135deg, var(--icon-gradient-start), var(--icon-gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.1));
        }

        /* Dark mode icon fallback */
        [data-theme="dark"] .app-icon {
            -webkit-text-fill-color: var(--icon-gradient-start, #ffffff);
            color: var(--icon-gradient-start, #ffffff);
            background: none;
        }

        .app-name {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .app-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            opacity: 0.8;
            line-height: 1.3;
        }

        .app-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ffcc00 0%, #ff6600 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .app-badge.new {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .app-badge.beta {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
        }

        /* Venezuelan K12 App Colors */
        .app-schedules {
            --icon-gradient-start: #003366;
            --icon-gradient-end: #004080;
        }

        .app-students {
            --icon-gradient-start: #ffcc00;
            --icon-gradient-end: #ff6600;
        }

        .app-teachers {
            --icon-gradient-start: #43e97b;
            --icon-gradient-end: #38f9d7;
        }

        .app-teacher-portal {
            --icon-gradient-start: #667eea;
            --icon-gradient-end: #764ba2;
        }

        .app-parent-portal {
            --icon-gradient-start: #ff9a9e;
            --icon-gradient-end: #fecfef;
        }

        .app-schedule-optimizer {
            --icon-gradient-start: #667eea;
            --icon-gradient-end: #764ba2;
        }

        .app-classrooms {
            --icon-gradient-start: #f093fb;
            --icon-gradient-end: #f5576c;
        }

        .app-reports {
            --icon-gradient-start: #667eea;
            --icon-gradient-end: #764ba2;
        }

        .app-admin {
            --icon-gradient-start: #fa709a;
            --icon-gradient-end: #fee140;
        }

        .app-bimodal {
            --icon-gradient-start: #4facfe;
            --icon-gradient-end: #00f2fe;
        }

        .app-matricula {
            --icon-gradient-start: #ff9a9e;
            --icon-gradient-end: #fecfef;
        }

        .logout-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
        }

        .footer-section {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: white;
            opacity: 0.9;
        }

        .footer-section small {
            font-size: 0.85rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .apps-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 20px;
                padding: 15px;
            }

            .app-tile {
                min-height: 150px;
                padding: 20px 10px;
            }

            .app-icon {
                font-size: 2.5rem;
            }

            .header-section h1 {
                font-size: 2rem;
            }

            .user-bar {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
        }

        /* Loading animation */
        .apps-grid.loading {
            opacity: 0;
            animation: fadeIn 0.8s ease forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- User Bar -->
        <div class="user-bar">
            <div class="dropdown">
                <button class="btn user-dropdown-toggle" type="button" id="userDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="user-name">👤 Administrador</span>
                    <i class="fas fa-chevron-down ml-2"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                    <div class="dropdown-item-text">
                        <small class="text-muted">Preferencias del usuario</small>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item d-flex align-items-center justify-content-between" href="#" id="darkModeToggle">
                        <span>
                            <i class="fas fa-moon mr-2" id="darkModeIcon"></i>
                            <span id="darkModeText">Modo Oscuro</span>
                        </span>
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="darkModeSwitch">
                            <label class="custom-control-label" for="darkModeSwitch"></label>
                        </div>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#" id="logoutBtn">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Cerrar Sesión
                    </a>
                </div>
            </div>
        </div>

        <!-- Header -->
        <div class="header-section">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px;">
                <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #003366, #ffcc00); border-radius: 30px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white; font-weight: bold; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.35); border: 4px solid rgba(255, 255, 255, 0.6);">
                    BS
                </div>
                <h1 style="margin: 0;">BiScheduler K12</h1>
            </div>
            <p style="margin-top: 15px;">Sistema de Gestión de Horarios - Educación Venezolana</p>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="active-students">245</div>
                    <div class="stat-label">Estudiantes Activos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-teachers">18</div>
                    <div class="stat-label">Docentes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="active-schedules">12</div>
                    <div class="stat-label">Horarios Activos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="system-status">✅</div>
                    <div class="stat-label">Estado del Sistema</div>
                </div>
            </div>
        </div>

        <!-- Apps Grid -->
        <div class="apps-grid loading">
            <!-- Schedule Management -->
            <a href="/bischeduler/schedules" class="app-tile app-schedules">
                <span class="app-icon">📅</span>
                <div class="app-name">Gestión de Horarios</div>
                <div class="app-description">Crear y administrar horarios académicos K12</div>
            </a>

            <!-- Student Management -->
            <a href="/bischeduler/students" class="app-tile app-students">
                <span class="app-icon">👨‍🎓</span>
                <div class="app-name">Estudiantes</div>
                <div class="app-description">Registro y gestión de estudiantes</div>
            </a>

            <!-- Teacher Management -->
            <a href="/bischeduler/teachers" class="app-tile app-teachers">
                <span class="app-icon">👩‍🏫</span>
                <div class="app-name">Docentes</div>
                <div class="app-description">Gestión de profesores y asignaciones</div>
            </a>

            <!-- Teacher Portal (Phase 4) -->
            <a href="/bischeduler/teacher-portal" class="app-tile app-teacher-portal">
                <span class="app-icon"><i class="fas fa-chalkboard-teacher"></i></span>
                <div class="app-name">Portal del Profesor</div>
                <div class="app-description">Auto-servicio de preferencias y horarios</div>
            </a>

            <!-- Exam Calendar (Phase 6) -->
            <a href="/bischeduler/exam-calendar" class="app-tile app-exam-calendar">
                <span class="app-icon">📝</span>
                <div class="app-name">Calendario de Exámenes</div>
                <div class="app-description">Programación y supervisión de exámenes</div>
            </a>

            <!-- Student Exam Dashboard (Phase 6) -->
            <a href="/bischeduler/student-exams" class="app-tile app-student-exams">
                <span class="app-icon">🎯</span>
                <div class="app-name">Panel del Estudiante</div>
                <div class="app-description">Exámenes próximos y notificaciones</div>
            </a>

            <!-- Parent Portal (Phase 7) -->
            <a href="/bischeduler/parent-portal" class="app-tile app-parent-portal">
                <span class="app-badge new">NUEVO</span>
                <span class="app-icon"><i class="fas fa-users"></i></span>
                <div class="app-name">Portal de Padres</div>
                <div class="app-description">Acceso a horarios e información de hijos</div>
            </a>

            <!-- Schedule Optimizer (Phase 8) -->
            <a href="/bischeduler/schedule-optimizer" class="app-tile app-schedule-optimizer">
                <span class="app-badge new">FASE 8</span>
                <span class="app-icon"><i class="fas fa-brain"></i></span>
                <div class="app-name">Optimizador de Horarios</div>
                <div class="app-description">Algoritmos avanzados para horarios óptimos</div>
            </a>

            <!-- Classroom Management -->
            <a href="/bischeduler/classrooms" class="app-tile app-classrooms">
                <span class="app-icon">🏫</span>
                <div class="app-name">Aulas</div>
                <div class="app-description">Administración de espacios físicos</div>
            </a>

            <!-- Bimodal Scheduling -->
            <a href="/bischeduler/bimodal" class="app-tile app-bimodal">
                <span class="app-badge new">NUEVO</span>
                <span class="app-icon">🔄</span>
                <div class="app-name">Bimodalidad</div>
                <div class="app-description">Gestión de horarios presencial/virtual</div>
            </a>

            <!-- Matrícula Reporting -->
            <a href="/bischeduler/matricula" class="app-tile app-matricula">
                <span class="app-badge">MINED</span>
                <span class="app-icon">📊</span>
                <div class="app-name">Matrícula</div>
                <div class="app-description">Reportes oficiales para MINED</div>
            </a>

            <!-- Reports -->
            <a href="/bischeduler/reports" class="app-tile app-reports">
                <span class="app-icon">📑</span>
                <div class="app-name">Reportes</div>
                <div class="app-description">Informes académicos y administrativos</div>
            </a>

            <!-- Administration -->
            <a href="/bischeduler/admin" class="app-tile app-admin">
                <span class="app-icon">⚙️</span>
                <div class="app-name">Administración</div>
                <div class="app-description">Configuración del sistema</div>
            </a>
        </div>

        <!-- Footer -->
        <div class="footer-section">
            <small>
                🇻🇪 Desarrollado para la Educación Venezolana |
                🏫 Compatible con normativas MINED |
                📅 BiScheduler K12 Platform
            </small>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dark Mode Toggle Implementation
        class DarkModeToggle {
            constructor() {
                this.init();
            }

            init() {
                const savedTheme = localStorage.getItem('bischeduler-theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const initialTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
                this.setTheme(initialTheme);

                // Initialize dropdown toggle
                this.initializeDropdownToggle();
            }

            initializeDropdownToggle() {
                const darkModeSwitch = document.getElementById('darkModeSwitch');
                const darkModeText = document.getElementById('darkModeText');
                const darkModeIcon = document.getElementById('darkModeIcon');

                // Update toggle state
                const updateToggleState = () => {
                    const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
                    darkModeSwitch.checked = isDarkMode;

                    if (isDarkMode) {
                        darkModeText.textContent = 'Modo Claro';
                        darkModeIcon.className = 'fas fa-sun mr-2';
                    } else {
                        darkModeText.textContent = 'Modo Oscuro';
                        darkModeIcon.className = 'fas fa-moon mr-2';
                    }
                };

                // Initialize state
                updateToggleState();

                // Handle toggle click
                document.getElementById('darkModeToggle').addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    // Toggle the switch
                    darkModeSwitch.checked = !darkModeSwitch.checked;

                    // Use BiScheduler's toggle method
                    this.toggleTheme();

                    // Update toggle state
                    setTimeout(updateToggleState, 100);
                });

                // Watch for external theme changes using MutationObserver
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                            updateToggleState();
                        }
                    });
                });

                observer.observe(document.documentElement, {
                    attributes: true,
                    attributeFilter: ['data-theme']
                });
            }

            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);
                localStorage.setItem('bischeduler-theme', newTheme);
            }

            setTheme(theme) {
                document.documentElement.classList.add('theme-transition');
                document.documentElement.setAttribute('data-theme', theme);

                const metaThemeColor = document.querySelector('meta[name="theme-color"]');
                if (metaThemeColor) {
                    metaThemeColor.setAttribute('content', theme === 'dark' ? '#1a1a1a' : '#003366');
                }

                setTimeout(() => {
                    document.documentElement.classList.remove('theme-transition');
                }, 50);
            }
        }

        // Logout functionality
        function handleLogout() {
            // Clear localStorage
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            localStorage.removeItem('user_info');
            localStorage.removeItem('bischeduler-theme');

            // Redirect to login page
            window.location.href = '/bischeduler/login';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new DarkModeToggle();

            // Add logout button event listener
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleLogout();
                });
            }

            // Force refresh dark mode styles for quick stats
            const forceRefreshStyles = () => {
                const quickStats = document.querySelector('.quick-stats');
                if (quickStats) {
                    const theme = document.documentElement.getAttribute('data-theme');
                    if (theme === 'dark') {
                        quickStats.style.background = 'var(--card-bg)';
                        quickStats.style.color = 'var(--text-primary)';

                        // Force refresh for stat values and labels
                        document.querySelectorAll('.stat-value').forEach(el => {
                            el.style.color = 'var(--text-primary)';
                        });
                        document.querySelectorAll('.stat-label').forEach(el => {
                            el.style.color = 'var(--text-secondary)';
                        });
                    }
                }
            };

            // Apply styles after DOM is ready
            setTimeout(forceRefreshStyles, 50);

            // Fade in animation for apps
            setTimeout(() => {
                document.querySelector('.apps-grid').classList.remove('loading');
            }, 100);

            // Add ripple effect to app tiles
            document.querySelectorAll('.app-tile').forEach(tile => {
                tile.addEventListener('click', function(e) {
                    const ripple = document.createElement('div');
                    ripple.style.cssText = `
                        position: absolute;
                        background: rgba(255, 255, 255, 0.6);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s ease-out;
                        pointer-events: none;
                    `;

                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;

                    ripple.style.width = ripple.style.height = size + 'px';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';

                    this.appendChild(ripple);

                    setTimeout(() => ripple.remove(), 600);
                });
            });
        });

        // Add ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>